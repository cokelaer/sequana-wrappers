# Documentation

This wrapper calls star with genomeGenerate command to build index of a genome

**Required input:**

- **fasta** : a FastA file with the genome reference. Generally, patches and alternative 
  haplotypes should not be included in the genome.
- **annotation** (optional): according to STAR  documentation, this is highly recommended to improve the accuracy
  of mapping. However, it is not compulsary and can still be provided during the mapping step, which
  is was is done in general in sequana pipelines. If provided, it should be a file  with annotated
  transcripts in the standard GTF format. STAR will extract splice junctions from this file and use
  them to greatly improve accuracy of the mapping. Starting from 2.4.1a, the annotations can also
  be included on the fly at the mapping step. See params section for GFF3 instead of GTF.

**Required output:**

- **done**: a filename used as a trigger of job done (do not use a STAR output file except if you are
  sure it is the last one generated by STAR).

**Required parameters:**

- **options**: a list of valid STAR options. Note that --sjdbGTFfile and --sjdbOVerhang
  are automatically set if an annotation is provided; sjdbOVerhang is set to 100 and
  can be overwritten in the params section. Moreover, if a GFF3 is provided,
  --sjdbGTFtagExonParentTranscript is set to 'Parent' automatically. Finally,
  --genomeSAindexNbases is set automatically based on genome length and STAR documentation.
- **wkdir**: place where results are saved. Set by default to *star_index*
- **sjdbOverhang**: according to STAR documentation, this parameter "specifies the length of
  the genomic sequence around the annotated junction to be used in constructing the splice
  junctions database. Ideally, this length should be equal to the ReadLength-1, where ReadLength
  is the length of the reads. For instance, for Illumina 2x100b paired-end reads, the ideal
  value is 100-1=99. In case of reads of varying length, the ideal value is max(ReadLength)-1.
  In most cases, the default value of 100 will work as well as the ideal value.
- **exonParentTranscript**: if you use a GFF3 file, you need to specify the
    parent-child relationship of the exons. BY default, set to *Parent*

**Log:**

- a log file is generated by STAR

# Configuration

    ##############################################################################
    # STAR indexing section
    #
    # :Parameters:
    #
    # optional parameters:
    #
    # - options: string with any valid STAR options
    # - sjdbOverhang: to be set only if an annotation is provided. If so, should
    #     set to the max(read length) -1. In most cases 100 will work as well as
    #     the ideal value according to STAR documentation.
    #  - genomeSAindexNbases is set automatically but one can overwrite the value 
    #      if required
    #  - annotation: optional GTF or GFF3 file. GTF is recommended. GFF3 can be 
    #       converted to GTF using gffread or bioconvert. annotation is not required
    #       at that stage. It can be use at the mapping stage when using star_align
    #  - exonParentTranscript: If annotation is GFF3, you need to specify the 
    #       parent-child relationship of the exons. By default, set to Parent'.
    star_index:
        annotation:
        threads: 4
        sjdbOVerhang: 100
        exonParentTranscript: Parent
        resources:
            mem: 4G

# Example

without annotation::

    rule star_index:
        input:
            fasta = "genome.fasta"
        output:
            done = "star_index/star.done"
        params:
            options= " ",
            wkdir="star_index",
        threads: 
            config['star_index']['threads']
        log:
            "star_index/star.log"
        resources:
            **config['star_index']['resources']
        wrapper:
            "add_star/wrappers/star_index"

with annotation (GFF)::

    rule star_index:
        input:
            fasta = "genome.fasta"
            annotation = config['star_index']['annotation']
        output:
            done = "star_index/star.done"
        params:
            options= " ",
            wkdir="star_index",
            exonParentTranscript=config['star_index']['exonParentTranscript']
        threads: config['star_index']['threads']
        log:
            "star_index/star.log"
        resources:
            **config['star_index']['resources']
        wrapper:
            "add_star/wrappers/star_index"


# References

https://github.com/alexdobin/STAR
